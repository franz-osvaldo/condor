$('.nano .content').html("<%= escape_javascript(render partial: 'alert_fluid_graph', collection: @alert_fluids, as: 'alert_fluid') %>");

<% @alert_fluids.each do |alert_fluid| %>
$('#<%= dom_id(alert_fluid) %>').highcharts({
  <% if alert_fluid.fluid.is_in_flight_hours? %>
  chart: {
    type: 'gauge',
    plotBackgroundColor: null,
    plotBackgroundImage: null,
    plotBorderWidth: 0,
    plotShadow: false
  },
  title: {
    text: 'CAMBIO - LUBRICACIÓN'
  },
  pane: {
    startAngle: -150,
    endAngle: 150,
    background: [{
      backgroundColor: {
        linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1 },
        stops: [
          [0, '#FFF'],
          [1, '#333']
        ]
      },
      borderWidth: 0,
      outerRadius: '109%'
    }, {
      backgroundColor: {
        linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1 },
        stops: [
          [0, '#333'],
          [1, '#FFF']
        ]
      },
      borderWidth: 1,
      outerRadius: '107%'
    }, {
      // default background
    }, {
      backgroundColor: '#DDD',
      borderWidth: 0,
      outerRadius: '105%',
      innerRadius: '103%'
    }]
  },
  yAxis: {
    min:  0,
    max: <%= alert_fluid.fluid.alert_before + alert_fluid.fluid.over_the_time_limit + alert_fluid.fluid.alert_before %>,

    minorTickInterval: 'auto',
    minorTickWidth: 1,
    minorTickLength: 10,
    minorTickPosition: 'inside',
    minorTickColor: '#666',

    tickPixelInterval: 30,
    tickWidth: 2,
    tickPosition: 'inside',
    tickLength: 10,
    tickColor: '#666',
    labels: {
      step: 2,
      rotation: 'auto'
    },
    title: {
      text: 'flight hours'
    },
    plotBands: [{
      from: 0,
      to: <%= alert_fluid.fluid.alert_before %>,
      color: '#55BF3B' // green
    },{
      from: <%= alert_fluid.fluid.alert_before %>,
      to: <%= alert_fluid.fluid.alert_before + alert_fluid.fluid.over_the_time_limit %>,
      color: '#DDDF0D' // yellow
    },{
      from: <%= alert_fluid.fluid.alert_before + alert_fluid.fluid.over_the_time_limit %>,
      to: <%= alert_fluid.fluid.alert_before + alert_fluid.fluid.over_the_time_limit + alert_fluid.fluid.alert_before %>,
      color: '#DF5353' // red
    }]
  },


  series: [{
    name: 'Actual',
    <% if alert_fluid.fluid.condition.name == 'TSN' %>
    data: [<%= TimeDetail.where('part_id = ? AND fleet_id = ?' , alert_fluid.fluid.part.id, alert_fluid.fleet.id).first.fhsn + alert_fluid.fluid.alert_before - (((TimeDetail.where('part_id = ? AND fleet_id = ?' , alert_fluid.fluid.part.id, alert_fluid.fleet.id).first.fhsn + alert_fluid.fluid.alert_before)/ alert_fluid.fluid.time_limit).to_i * alert_fluid.fluid.time_limit) %>],
    <% end %>
    <% if alert_fluid.fluid.condition.name == 'TSO' %>
    data: [<%= TimeDetail.where('part_id = ? AND fleet_id = ?' , alert_fluid.fluid.part.id, alert_fluid.fleet.id).first.fhso + alert_fluid.fluid.alert_before - (((TimeDetail.where('part_id = ? AND fleet_id = ?' , alert_fluid.fluid.part.id, alert_fluid.fleet.id).first.fhsn + alert_fluid.fluid.alert_before)/ alert_fluid.fluid.time_limit).to_i * alert_fluid.fluid.time_limit) %>],
    <% end %>
    <% if alert_fluid.fluid.condition.name == 'No requerido' %>
      <% if !Condition.joins(fluids: :part).where('parts.id = ?', alert_fluid.fluid.part.id).empty?%>
        data: [<%= (TimeDetail.where('part_id = ? AND fleet_id = ?' , alert_fluid.fluid.part.id, alert_fluid.fleet.id).first.fhsn % alert_fluid.fluid.time_limit + alert_fluid.fluid.alert_before) % alert_fluid.fluid.time_limit - alert_fluid.fluid.part.fluids.joins(:condition).where('conditions.name = ?', 'TSN').first.time_limit%>],
      <% else %>
        data: [<%= (TimeDetail.where('part_id = ? AND fleet_id = ?' , alert_fluid.fluid.part.id, alert_fluid.fleet.id).first.fhsn % alert_fluid.fluid.time_limit + alert_fluid.fluid.alert_before) % alert_fluid.fluid.time_limit %>],
      <% end %>
    <% end %>
    tooltip: {
      valueSuffix: 'Flight hours'
    }
  }],
  <% else %>

  chart: {
    type: 'gauge',
    plotBackgroundColor: null,
    plotBackgroundImage: null,
    plotBorderWidth: 0,
    plotShadow: false
  },
  title: {
    text: 'CAMBIO - LUBRICACIÓN'
  },
  pane: {
    startAngle: -150,
    endAngle: 150,
    background: [{
      backgroundColor: {
        linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1 },
        stops: [
          [0, '#FFF'],
          [1, '#333']
        ]
      },
      borderWidth: 0,
      outerRadius: '109%'
    }, {
      backgroundColor: {
        linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1 },
        stops: [
          [0, '#333'],
          [1, '#FFF']
        ]
      },
      borderWidth: 1,
      outerRadius: '107%'
    }, {
      // default background
    }, {
      backgroundColor: '#DDD',
      borderWidth: 0,
      outerRadius: '105%',
      innerRadius: '103%'
    }]
  },
  yAxis: {
    min: <%= alert_fluid.fluid.time_limit - alert_fluid.fluid.alert_before %>,
    max: <%= alert_fluid.fluid.time_limit + alert_fluid.fluid.over_the_time_limit + alert_fluid.fluid.alert_before %>,

    minorTickInterval: 'auto',
    minorTickWidth: 1,
    minorTickLength: 10,
    minorTickPosition: 'inside',
    minorTickColor: '#666',

    tickPixelInterval: 30,
    tickWidth: 2,
    tickPosition: 'inside',
    tickLength: 10,
    tickColor: '#666',
    labels: {
      step: 2,
      rotation: 'auto'
    },
    title: {
      text: 'flight hours'
    },
    plotBands: [{
      from: <%= alert_fluid.fluid.time_limit - alert_fluid.fluid.alert_before %>,
      to: <%= alert_fluid.fluid.time_limit %>,
      color: '#55BF3B' // green
    },{
      from: <%= alert_fluid.fluid.time_limit %>,
      to: <%= alert_fluid.fluid.time_limit + alert_fluid.fluid.over_the_time_limit %>,
      color: '#DDDF0D' // yellow
    },{
      from: <%= alert_fluid.fluid.time_limit + alert_fluid.fluid.over_the_time_limit %>,
      to: <%= alert_fluid.fluid.time_limit + alert_fluid.fluid.over_the_time_limit + alert_fluid.fluid.alert_before %>,
      color: '#DF5353' // red
    }]
  },


  series: [{
    name: 'Actual',
    data: [<%= TimeDetail.where('part_id = ? AND fleet_id = ?' , alert_fluid.fluid.part.id, alert_fluid.fleet.id).first.fhsn % alert_fluid.fluid.time_limit%>],
    tooltip: {
      valueSuffix: 'Flight hours'
    }
  }],

  <% end%>


});
<% end %>